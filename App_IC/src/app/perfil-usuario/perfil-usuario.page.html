<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Mi Perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- üë§ Informaci√≥n del Usuario -->
  <ion-card *ngIf="!cargando">
    <ion-card-header>
      <ion-card-title>üìã Informaci√≥n Personal</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <!-- Correo -->
      <ion-item>
        <ion-label position="floating">Correo electr√≥nico</ion-label>
        <ion-input [(ngModel)]="usuario.correo" type="email"></ion-input>
      </ion-item>

      <!-- Celular -->
      <ion-item>
        <ion-label position="floating">Celular</ion-label>
        <ion-input [(ngModel)]="usuario.celular" type="tel"></ion-input>
      </ion-item>

      <!-- Discapacidad -->
      <ion-item>
        <ion-label>Tipo de discapacidad</ion-label>
        <ion-select [(ngModel)]="usuario.Discapacidades_id_discapacidad">
          <ion-select-option *ngFor="let d of discapacidades" [value]="d.id_discapacidad">
            {{ d.tipo_discapacidad }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Bot√≥n Guardar -->
      <ion-button expand="block" color="success" (click)="guardarCambios()">
        <ion-icon slot="start" name="save"></ion-icon>
        Guardar Cambios
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- üìä Estad√≠sticas del Usuario -->
  <ion-card *ngIf="!cargando && rutasGuardadas.length > 0">
    <ion-card-header>
      <ion-card-title>üìä Mis Estad√≠sticas</ion-card-title>
      <ion-card-subtitle>Tu actividad en la plataforma</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="4">
            <div class="stat-box">
              <ion-icon name="map" color="primary" class="stat-icon"></ion-icon>
              <h2 class="stat-number">{{ rutasGuardadas.length }}</h2>
              <p class="stat-label">Rutas creadas</p>
            </div>
          </ion-col>
          <ion-col size="4">
            <div class="stat-box">
              <ion-icon name="navigate" color="success" class="stat-icon"></ion-icon>
              <h2 class="stat-number">{{ calcularDistanciaTotal() }}</h2>
              <p class="stat-label">km recorridos</p>
            </div>
          </ion-col>
          <ion-col size="4">
            <div class="stat-box">
              <ion-icon name="star" color="warning" class="stat-icon"></ion-icon>
              <h2 class="stat-number">{{ resenasUsuario.length }}</h2>
              <p class="stat-label">Rese√±as</p>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

  <!-- ‚≠ê Mis Rese√±as -->
  <ion-card *ngIf="!cargando">
    <ion-card-header>
      <ion-card-title>‚≠ê Mis Rese√±as a Servicios</ion-card-title>
      <ion-card-subtitle>
        {{ resenasUsuario.length > 0 ? resenasUsuario.length + ' rese√±a(s) realizadas' : 'A√∫n no has dejado rese√±as' }}
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <!-- Lista de rese√±as -->
      <div *ngIf="resenasUsuario.length > 0">
        <ion-list>
          <ion-item *ngFor="let resena of resenasUsuario" class="resena-item">
            <ion-label class="ion-text-wrap">
              <!-- Nombre del servicio/lugar -->
              <h2 class="resena-servicio">
                <ion-icon name="business" color="primary"></ion-icon>
                {{ resena.nombre_lugar || 'Servicio sin nombre' }}
              </h2>

              <!-- Valoraci√≥n con estrellas -->
              <div class="resena-valoracion">
                <ion-icon 
                  *ngFor="let star of [1,2,3,4,5]" 
                  [name]="star <= resena.valoracion ? 'star' : 'star-outline'"
                  [color]="star <= resena.valoracion ? 'warning' : 'medium'"
                  class="star-icon">
                </ion-icon>
                <span class="valoracion-numero">{{ resena.valoracion }}/5</span>
              </div>

              <!-- Comentario -->
              <p class="resena-comentario">
                <ion-icon name="chatbox" color="medium"></ion-icon>
                "{{ resena.comentarios || 'Sin comentario' }}"
              </p>

              <!-- Fecha -->
              <p class="resena-fecha">
                <ion-icon name="calendar" color="medium"></ion-icon>
                {{ resena.fecha_resena | date:'dd/MM/yyyy' }}
              </p>

              <!-- Informaci√≥n adicional del lugar -->
              <div class="resena-info" *ngIf="resena.direccion_lugar || resena.nombre_empresa">
                <p *ngIf="resena.direccion_lugar">
                  <ion-icon name="location" color="medium"></ion-icon>
                  {{ resena.direccion_lugar }}
                </p>
                <p *ngIf="resena.nombre_empresa">
                  <ion-icon name="briefcase" color="medium"></ion-icon>
                  {{ resena.nombre_empresa }}
                </p>
              </div>
            </ion-label>

            <!-- Bot√≥n de eliminar rese√±a -->
            <ion-button slot="end" fill="clear" color="danger" (click)="eliminarResena(resena.id_resena)">
              <ion-icon slot="icon-only" name="trash"></ion-icon>
            </ion-button>
          </ion-item>
        </ion-list>
      </div>

      <!-- Mensaje si no hay rese√±as -->
      <div *ngIf="resenasUsuario.length === 0" class="sin-rese√±as">
        <ion-icon name="chatbox-outline" size="large" color="medium"></ion-icon>
        <p>A√∫n no has dejado rese√±as en ning√∫n servicio.</p>
        <p class="hint">Explora servicios en el men√∫ principal y comparte tu experiencia.</p>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Spinner de carga -->
  <div *ngIf="cargando" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Cargando informaci√≥n...</p>
  </div>

</ion-content>