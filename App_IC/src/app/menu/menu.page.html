<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>ğŸ“ Mis Rutas GPS</ion-title>
    
    <ion-buttons slot="end">
      <ion-button (click)="getCurrentPosition()">
        <ion-icon slot="icon-only" name="locate"></ion-icon>
      </ion-button>
      <ion-button (click)="verMisRutas()">
        <ion-icon slot="icon-only" name="map"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Barra de grabaciÃ³n en tiempo real -->
  <ion-toolbar *ngIf="isRecording" color="danger">
    <ion-grid>
      <ion-row>
        <ion-col size="4">
          <div style="text-align: center;">
            <ion-text>
              <h3 style="margin: 0;">{{ totalDistance.toFixed(2) }}</h3>
              <p style="margin: 0; font-size: 12px;">km</p>
            </ion-text>
          </div>
        </ion-col>
        <ion-col size="4">
          <div style="text-align: center;">
            <ion-text>
              <h3 style="margin: 0;">{{ elapsedTime }}</h3>
              <p style="margin: 0; font-size: 12px;">tiempo</p>
            </ion-text>
          </div>
        </ion-col>
        <ion-col size="4">
          <div style="text-align: center;">
            <ion-text>
              <h3 style="margin: 0;">{{ recordedPoints.length }}</h3>
              <p style="margin: 0; font-size: 12px;">puntos GPS</p>
            </ion-text>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  
  <!-- ğŸ” Panel de Debug GPS (temporal) -->
  <ion-card color="light" *ngIf="currentLocation">
    <ion-card-content>
      <p style="margin: 0; font-size: 11px;">
        <b>ğŸ›°ï¸ GPS Activo:</b><br>
        ğŸ“ Lat: {{ currentLocation[0].toFixed(6) }}<br>
        ğŸ“ Lng: {{ currentLocation[1].toFixed(6) }}
      </p>
    </ion-card-content>
  </ion-card>

  <ion-card color="warning" *ngIf="!currentLocation">
    <ion-card-content>
      <p style="margin: 0; font-size: 12px; text-align: center;">
        âš ï¸ <b>GPS no conectado</b><br>
        Presiona el Ã­cono ğŸ“ arriba para obtener tu ubicaciÃ³n
      </p>
    </ion-card-content>
  </ion-card>
  
  <!-- ğŸ—ºï¸ Mapa principal -->
  <div id="map" style="height: 500px; width: 100%; border-radius: 10px; overflow: hidden; margin-bottom: 10px;"></div>

  <!-- ğŸ¬ Controles de grabaciÃ³n GPS -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="navigate-circle" style="vertical-align: middle;"></ion-icon>
        Grabar Mi Ruta GPS
      </ion-card-title>
      <ion-card-subtitle>
        {{ isRecording ? 'ğŸ”´ GRABANDO GPS... Camina y tu ruta se guardarÃ¡ automÃ¡ticamente' : 'Crea y comparte tus rutas accesibles usando GPS real' }}
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-button 
        *ngIf="!isRecording"
        expand="block" 
        color="success" 
        (click)="startRecording()">
        <ion-icon slot="start" name="play-circle"></ion-icon>
        Iniciar GrabaciÃ³n GPS
      </ion-button>

      <ion-button 
        *ngIf="isRecording"
        expand="block" 
        color="danger" 
        (click)="stopRecording()">
        <ion-icon slot="start" name="stop-circle"></ion-icon>
        Finalizar y Guardar Ruta
      </ion-button>

      <!-- InformaciÃ³n durante la grabaciÃ³n -->
      <div *ngIf="isRecording" style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 8px;">
        <p style="margin: 5px 0; font-size: 14px;">
          <ion-icon name="speedometer" style="vertical-align: middle;"></ion-icon>
          <strong>Velocidad actual:</strong> {{ currentSpeed.toFixed(1) }} km/h
        </p>
        <p style="margin: 5px 0; font-size: 14px;">
          <ion-icon name="location" style="vertical-align: middle;"></ion-icon>
          <strong>PrecisiÃ³n GPS:</strong> Alta (tracking activo)
        </p>
      </div>

      <!-- Instrucciones cuando no estÃ¡ grabando -->
      <ion-text *ngIf="!isRecording" color="medium">
        <p style="font-size: 12px; margin-top: 10px;">
          ğŸ’¡ <b>CÃ³mo funciona:</b><br>
          1ï¸âƒ£ Presiona "Iniciar GrabaciÃ³n GPS"<br>
          2ï¸âƒ£ Camina o desplÃ¡zate por tu ruta<br>
          3ï¸âƒ£ El GPS grabarÃ¡ automÃ¡ticamente cada punto de tu recorrido<br>
          4ï¸âƒ£ Presiona "Finalizar" cuando llegues al destino<br>
          5ï¸âƒ£ Dale un nombre descriptivo y guarda tu ruta<br><br>
          
          ğŸ“± <b>Requisitos:</b><br>
          â€¢ GPS activado en tu dispositivo<br>
          â€¢ ConexiÃ³n estable para mejor precisiÃ³n<br>
          â€¢ Caminar al menos 10 metros para registrar puntos
        </p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <!-- ğŸŒŸ InformaciÃ³n de rutas guardadas -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>ğŸŒŸ Tus Rutas Guardadas</ion-card-title>
      <ion-card-subtitle>
        {{ rutasGuardadas.length === 0 ? 'AÃºn no has creado rutas' : rutasGuardadas.length + ' ruta(s) disponible(s)' }}
      </ion-card-subtitle>
    </ion-card-header>
    
    <ion-card-content>
      <div *ngIf="rutasGuardadas.length === 0">
        <p style="text-align: center; color: #666;">
          ğŸ“ No tienes rutas GPS guardadas aÃºn.<br>
          Â¡Crea tu primera ruta para ayudar a otros usuarios!
        </p>
      </div>

      <div *ngIf="rutasGuardadas.length > 0">
        <p>
          Tus rutas estÃ¡n visibles en el mapa con diferentes colores.
          Haz clic en el Ã­cono de mapa (ğŸ“) arriba para ver el listado completo.
        </p>
        
        <ion-list>
          <ion-item *ngFor="let ruta of rutasGuardadas.slice(0, 3)">
            <ion-label>
              <h3>{{ ruta.nombre_ruta }}</h3>
              <p>{{ ruta.descripcion_ruta || 'Sin descripciÃ³n' }}</p>
              <p><small>ğŸ“ {{ ruta.longitud_ruta }} km | ğŸ“ {{ ruta.coordenadas?.length || 0 }} puntos GPS</small></p>
            </ion-label>
            <ion-button slot="end" fill="clear" (click)="cargarRutaEnMapa(ruta.id_ruta)">
              <ion-icon name="eye" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-item>
        </ion-list>

        <ion-button 
          *ngIf="rutasGuardadas.length > 3"
          expand="block" 
          fill="outline" 
          (click)="verMisRutas()">
          <ion-icon slot="start" name="list"></ion-icon>
          Ver todas ({{ rutasGuardadas.length }})
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- ğŸ“Š EstadÃ­sticas (opcional) -->
  <ion-card *ngIf="rutasGuardadas.length > 0">
    <ion-card-header>
      <ion-card-title>ğŸ“Š Tus EstadÃ­sticas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <div style="text-align: center;">
              <h2 style="margin: 0; color: #3880ff;">{{ rutasGuardadas.length }}</h2>
              <p style="margin: 5px 0; font-size: 12px;">Rutas creadas</p>
            </div>
          </ion-col>
          <ion-col size="6">
            <div style="text-align: center;">
              <h2 style="margin: 0; color: #10dc60;">{{ calcularDistanciaTotal() }}</h2>
              <p style="margin: 5px 0; font-size: 12px;">km totales</p>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>

</ion-content>