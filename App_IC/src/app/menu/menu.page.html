<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Rutas Accesibles</ion-title>
    
    <ion-buttons slot="end">
      <ion-button (click)="verMisRutas()">
        <ion-icon slot="icon-only" name="map"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Barra de grabaci√≥n en tiempo real -->
  <ion-toolbar *ngIf="isRecording" color="danger">
    <ion-grid>
      <ion-row>
        <ion-col size="4">
          <div style="text-align: center;">
            <ion-text>
              <h3 style="margin: 0;">{{ totalDistance.toFixed(2) }}</h3>
              <p style="margin: 0; font-size: 12px;">km</p>
            </ion-text>
          </div>
        </ion-col>
        <ion-col size="4">
          <div style="text-align: center;">
            <ion-text>
              <h3 style="margin: 0;">{{ elapsedTime }}</h3>
              <p style="margin: 0; font-size: 12px;">tiempo</p>
            </ion-text>
          </div>
        </ion-col>
        <ion-col size="4">
          <div style="text-align: center;">
            <ion-text>
              <h3 style="margin: 0;">{{ recordedPoints.length }}</h3>
              <p style="margin: 0; font-size: 12px;">puntos</p>
            </ion-text>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  
  <!-- üó∫Ô∏è Mapa principal -->
  <div id="map" style="height: 400px; width: 100%; border-radius: 10px; overflow: hidden;"></div>

  <!-- üé¨ Controles de grabaci√≥n -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="navigate-circle" style="vertical-align: middle;"></ion-icon>
        Grabar Mi Ruta
      </ion-card-title>
      <ion-card-subtitle>
        {{ isRecording ? 'üî¥ GRABANDO... Camina y tu ruta se guardar√° autom√°ticamente' : 'Comparte tus rutas accesibles con la comunidad' }}
      </ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-button 
        *ngIf="!isRecording"
        expand="block" 
        color="success" 
        (click)="startRecording()">
        <ion-icon slot="start" name="play-circle"></ion-icon>
        Iniciar Grabaci√≥n
      </ion-button>

      <ion-button 
        *ngIf="isRecording"
        expand="block" 
        color="danger" 
        (click)="stopRecording()">
        <ion-icon slot="start" name="stop-circle"></ion-icon>
        Finalizar y Guardar
      </ion-button>

      <ion-text *ngIf="!isRecording" color="medium">
        <p style="font-size: 12px; margin-top: 10px;">
          üí° <b>C√≥mo funciona:</b><br>
          1. Presiona "Iniciar Grabaci√≥n"<br>
          2. Camina o conduce por tu ruta<br>
          3. El GPS grabar√° autom√°ticamente tu recorrido<br>
          4. Presiona "Finalizar" cuando llegues al destino<br>
          5. Dale un nombre y comparte tu ruta
        </p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <!-- Buscador y filtros (solo cuando no est√° grabando) -->
  <div *ngIf="!isRecording">
    <ion-searchbar 
      [(ngModel)]="searchText" 
      debounce="500" 
      placeholder="Buscar lugares...">
    </ion-searchbar>

    <ion-item>
      <ion-label>Filtrar por categor√≠a</ion-label>
      <ion-select [(ngModel)]="selectedCategory" placeholder="Todas">
        <ion-select-option value="">Todas</ion-select-option>
        <ion-select-option value="restaurante">Restaurantes</ion-select-option>
        <ion-select-option value="agencia_turismo">Agencia de Turismo</ion-select-option>
        <ion-select-option value="transporte">Transporte</ion-select-option>
      </ion-select>
    </ion-item>

    <!-- Listado filtrado -->
    <ion-list>
      <ion-item *ngFor="let item of filteredItems()">
        <ion-label>
          <h2>{{ item.name }}</h2>
          <p>{{ item.address }}</p>
          <p><small>{{ item.category }}</small></p>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <!-- üí° Informaci√≥n adicional -->
  <ion-card *ngIf="!isRecording">
    <ion-card-header>
      <ion-card-title>üåü Rutas Recomendadas</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>
        Explora rutas accesibles creadas por otros usuarios. 
        Haz clic en el √≠cono de mapa (üìç) arriba para ver todas las rutas disponibles.
      </p>
      <ion-button expand="block" fill="outline" (click)="verMisRutas()">
        <ion-icon slot="start" name="map"></ion-icon>
        Ver Mis Rutas
      </ion-button>
    </ion-card-content>
  </ion-card>

</ion-content>